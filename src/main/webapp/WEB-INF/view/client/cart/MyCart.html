<%@page contentType="text/html" pageEncoding="UTF-8"%> <%@ taglib prefix="c"
uri="http://java.sun.com/jsp/jstl/core"%> <%@taglib
uri="http://www.springframework.org/tags/form" prefix="form"%><%@ taglib
uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>My Cart - EduLearn</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <!-- header start -->
    <jsp:include page="../layout/header.jsp" />
    <!-- header end -->

    <div class="main-content">
      <div class="cart-page">
        <div class="cart-container">
          <!-- Cart Header -->
          <div class="cart-header">
            <h1 class="cart-title">My Cart</h1>
            <p class="cart-count">3 courses in your cart</p>
          </div>

          <div class="cart-content">
            <!-- Cart Items -->
            <div class="cart-items">
              <!-- Select All -->
              <div class="cart-select-all">
                <input type="checkbox" id="selectAll" />
                <label for="selectAll">Chọn tất cả</label>
              </div>

              <!-- Cart Item 1 -->
              <div class="cart-item">
                <button class="cart-delete-btn">
                  <img src="/images/myCart/button_delete.svg" alt="Delete" />
                </button>
                <div class="cart-item-checkbox">
                  <input
                    type="checkbox"
                    id="item1"
                    name="cartItem"
                    class="item-checkbox"
                  />
                  <label for="item1"></label>
                </div>
                <div class="cart-item-thumbnail">
                  <div class="cart-thumbnail-placeholder"></div>
                </div>
                <div class="cart-item-info">
                  <h3 class="cart-item-title">
                    Complete Web Development Bootcamp 2024
                  </h3>
                  <p class="cart-item-instructor">John Smith</p>
                  <div class="cart-item-rating">
                    <span class="rating-score">4.8</span>
                    <img
                      src="/images/myCart/icon_star.svg"
                      alt="Star"
                      class="rating-star"
                    />
                    <span class="rating-count">(15,420)</span>
                  </div>
                  <p class="cart-item-duration">42 hours</p>
                </div>
                <div class="cart-item-price">
                  <span class="current-price">$59.99</span>
                  <span class="original-price">$129.99</span>
                </div>
              </div>

              <!-- Cart Item 2 -->
              <div class="cart-item">
                <button class="cart-delete-btn">
                  <img src="/images/myCart/button_delete.svg" alt="Delete" />
                </button>
                <div class="cart-item-checkbox">
                  <input
                    type="checkbox"
                    id="item2"
                    name="cartItem"
                    class="item-checkbox"
                  />
                  <label for="item2"></label>
                </div>
                <div class="cart-item-thumbnail">
                  <div class="cart-thumbnail-placeholder"></div>
                </div>
                <div class="cart-item-info">
                  <h3 class="cart-item-title">
                    Advanced React & Redux Complete Course
                  </h3>
                  <p class="cart-item-instructor">Sarah Johnson</p>
                  <div class="cart-item-rating">
                    <span class="rating-score">4.9</span>
                    <img
                      src="/images/myCart/icon_star.svg"
                      alt="Star"
                      class="rating-star"
                    />
                    <span class="rating-count">(12,350)</span>
                  </div>
                  <p class="cart-item-duration">35 hours</p>
                </div>
                <div class="cart-item-price">
                  <span class="current-price">$79.99</span>
                  <span class="original-price">$149.99</span>
                </div>
              </div>

              <!-- Cart Item 3 -->
              <div class="cart-item">
                <button class="cart-delete-btn">
                  <img src="/images/myCart/button_delete.svg" alt="Delete" />
                </button>
                <div class="cart-item-checkbox">
                  <input
                    type="checkbox"
                    id="item3"
                    name="cartItem"
                    class="item-checkbox"
                  />
                  <label for="item3"></label>
                </div>
                <div class="cart-item-thumbnail">
                  <div class="cart-thumbnail-placeholder"></div>
                </div>
                <div class="cart-item-info">
                  <h3 class="cart-item-title">
                    UI/UX Design Masterclass - From Beginner to Pro
                  </h3>
                  <p class="cart-item-instructor">Michael Chen</p>
                  <div class="cart-item-rating">
                    <span class="rating-score">4.7</span>
                    <img
                      src="/images/myCart/icon_star.svg"
                      alt="Star"
                      class="rating-star"
                    />
                    <span class="rating-count">(8,920)</span>
                  </div>
                  <p class="cart-item-duration">28 hours</p>
                </div>
                <div class="cart-item-price">
                  <span class="current-price">$49.99</span>
                </div>
              </div>
            </div>

            <!-- Order Summary -->
            <div class="cart-summary">
              <h3 class="summary-title">Tóm tắt đơn hàng</h3>

              <div class="summary-row">
                <span class="summary-label">Giá gốc:</span>
                <span class="summary-value" id="originalPrice">$0.00</span>
              </div>

              <div class="summary-row">
                <span class="summary-label">Giảm giá:</span>
                <span class="summary-value discount" id="discountPrice"
                  >-$0.00</span
                >
              </div>

              <div class="summary-divider"></div>

              <div class="summary-row total">
                <span class="summary-label">Tổng cộng:</span>
                <span class="summary-value total-price" id="totalPrice"
                  >$0.00</span
                >
              </div>

              <div class="summary-notice" id="summaryNotice">
                <p>Vui lòng chọn ít nhất 1 khóa học để thanh toán</p>
              </div>

              <a
                href="#"
                class="btn-checkout"
                id="checkoutBtn"
                style="display: none"
                onclick="goToCheckout(event)"
              >
                Thanh toán (<span id="selectedCount">0</span>)
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- footer start -->
    <jsp:include page="../layout/footer.jsp" />
    <!-- footer end -->

    <script>
      // Select All functionality
      const selectAllCheckbox = document.getElementById("selectAll");

      selectAllCheckbox.addEventListener("change", function () {
        const itemCheckboxes = document.querySelectorAll(".item-checkbox");
        itemCheckboxes.forEach((checkbox) => {
          checkbox.checked = this.checked;
        });
        updateSummary();
      });

      // Update select all checkbox state when individual items change
      function updateSelectAllState() {
        const itemCheckboxes = document.querySelectorAll(".item-checkbox");
        const allChecked = Array.from(itemCheckboxes).every((cb) => cb.checked);
        const someChecked = Array.from(itemCheckboxes).some((cb) => cb.checked);

        selectAllCheckbox.checked = allChecked;
        selectAllCheckbox.indeterminate = someChecked && !allChecked;
      }

      function updateSummary() {
        let originalTotal = 0;
        let discountTotal = 0;
        let selectedCount = 0;

        document.querySelectorAll(".cart-item").forEach((item) => {
          const checkbox = item.querySelector(".cart-item-checkbox input");
          if (checkbox && checkbox.checked) {
            selectedCount++;
            const currentPriceEl = item.querySelector(".current-price");
            const originalPriceEl = item.querySelector(".original-price");

            const currentPrice = parseFloat(
              currentPriceEl.textContent.replace("$", "")
            );
            const originalPrice = originalPriceEl
              ? parseFloat(originalPriceEl.textContent.replace("$", ""))
              : currentPrice;

            originalTotal += originalPrice;
            discountTotal += originalPrice - currentPrice;
          }
        });

        const finalTotal = originalTotal - discountTotal;

        document.getElementById("originalPrice").textContent =
          "$" + originalTotal.toFixed(2);
        document.getElementById("discountPrice").textContent =
          "-$" + discountTotal.toFixed(2);
        document.getElementById("totalPrice").textContent =
          "$" + finalTotal.toFixed(2);

        const notice = document.getElementById("summaryNotice");
        const checkoutBtn = document.getElementById("checkoutBtn");
        const selectedCountEl = document.getElementById("selectedCount");

        if (selectedCount > 0) {
          notice.style.display = "none";
          checkoutBtn.style.display = "block";
          selectedCountEl.textContent = selectedCount;
        } else {
          notice.style.display = "block";
          checkoutBtn.style.display = "none";
        }

        updateSelectAllState();
      }

      // Add event listeners to individual checkboxes
      document.querySelectorAll(".item-checkbox").forEach((checkbox) => {
        checkbox.addEventListener("change", updateSummary);
      });

      // Delete item functionality
      document.querySelectorAll(".cart-delete-btn").forEach((btn) => {
        btn.addEventListener("click", function () {
          const cartItem = this.closest(".cart-item");
          cartItem.style.opacity = "0";
          cartItem.style.transform = "translateX(-20px)";
          setTimeout(() => {
            cartItem.remove();
            updateCartCount();
            updateSummary();
          }, 300);
        });
      });

      function updateCartCount() {
        const remainingItems = document.querySelectorAll(".cart-item").length;
        document.querySelector(".cart-count").textContent =
          remainingItems + " courses in your cart";
      }

      // Save selected items to localStorage and go to checkout
      function goToCheckout(event) {
        event.preventDefault();

        const selectedItems = [];

        document.querySelectorAll(".cart-item").forEach((item) => {
          const checkbox = item.querySelector(".cart-item-checkbox input");
          if (checkbox && checkbox.checked) {
            const title = item.querySelector(".cart-item-title").textContent;
            const instructor = item.querySelector(
              ".cart-item-instructor"
            ).textContent;
            const currentPriceEl = item.querySelector(".current-price");
            const originalPriceEl = item.querySelector(".original-price");

            const currentPrice = parseFloat(
              currentPriceEl.textContent.replace("$", "")
            );
            const originalPrice = originalPriceEl
              ? parseFloat(originalPriceEl.textContent.replace("$", ""))
              : null;

            selectedItems.push({
              title: title,
              instructor: instructor,
              currentPrice: currentPrice,
              originalPrice: originalPrice,
            });
          }
        });

        // Save to localStorage
        localStorage.setItem("checkoutItems", JSON.stringify(selectedItems));

        // Navigate to checkout
        window.location.href = "Payment.html";
      }
    </script>
  </body>
</html>
