<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>My Cart - EduLearn</title>
    <link rel="stylesheet" href="../../../resources/css/style.css" />
  </head>
  <body>
    <header class="header">
      <div class="container header-inner">
        <div class="brand">
          <div class="logo">
            <img src="../../../resources/images/logo.svg" alt="EduLearn" />
          </div>
          <div class="name-brand">EduLearn</div>
        </div>
        <nav class="nav">
            <a href="UserDashboard.html" class="nav-link">Home</a>
            <a href="UserExplore.html" class="nav-link">Explore</a>
            <a href="TutorCourses.html" class="nav-link">Tutor Now</a>
            <a href="Enrollments.html" class="nav-link">Enrollments</a>
        </nav>
        <div class="actions">
          <div class="user-menu">
            <a href="MyCart.html" class="cart-btn active">
              <img src="../../../resources/images/userHeader/icon_cart.svg" alt="Cart" width="20" height="20" />
            </a>
            <button class="message-btn">
              <img src="../../../resources/images/userHeader/icon_mess.svg" alt="Messages" width="20" height="20" />
            </button>
            <button class="notification-btn" id="openNotiBtn">
              <img src="../../../resources/images/userHeader/icon_noti.svg" alt="Notifications" width="20" height="20" />
            </button>
            <div class="user-profile-wrapper">
              <button class="user-profile" id="userMenuBtn" aria-expanded="false" aria-haspopup="true">
                <img src="../../../resources/images/userHeader/user_avt.svg" alt="User Avatar" class="user-avatar-img" />
                <img src="../../../resources/images/userHeader/icon_down.svg" alt="Dropdown" class="user-dropdown-icon" />
              </button>
              <div class="user-menu-dropdown" id="userMenuDropdown">
                <ul class="user-menu-list">
                  <li class="user-menu-item">
                    <a href="MyProfile.html" class="user-menu-link">
                      <img src="../../../resources/images/userMenu/icon_profile.svg" alt="Profile" class="user-menu-icon" />
                      <div class="user-menu-text">
                        <span class="user-menu-label">My Profile</span>
                        <span class="user-menu-desc">View and edit profile</span>
                      </div>
                    </a>
                  </li>
                  <li class="user-menu-item">
                    <a href="Login.html" class="user-menu-link user-menu-link--logout">
                      <img src="../../../resources/images/userMenu/icon_logOut.svg" alt="Logout" class="user-menu-icon" />
                      <div class="user-menu-text">
                        <span class="user-menu-label">Logout</span>
                        <span class="user-menu-desc">Sign out of your account</span>
                      </div>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="main-content">
      <div class="cart-page">
        <div class="cart-container">
          <!-- Cart Header -->
          <div class="cart-header">
            <h1 class="cart-title">My Cart</h1>
            <p class="cart-count">3 courses in your cart</p>
          </div>

          <div class="cart-content">
            <!-- Cart Items -->
            <div class="cart-items">
              <!-- Select All -->
              <div class="cart-select-all">
                <input type="checkbox" id="selectAll" />
                <label for="selectAll">Chọn tất cả</label>
              </div>

              <!-- Cart Item 1 -->
              <div class="cart-item">
                <button class="cart-delete-btn">
                  <img src="../../../resources/images/myCart/button_delete.svg" alt="Delete" />
                </button>
                <div class="cart-item-checkbox">
                  <input type="checkbox" id="item1" name="cartItem" class="item-checkbox" />
                  <label for="item1"></label>
                </div>
                <div class="cart-item-thumbnail">
                  <div class="cart-thumbnail-placeholder"></div>
                </div>
                <div class="cart-item-info">
                  <h3 class="cart-item-title">Complete Web Development Bootcamp 2024</h3>
                  <p class="cart-item-instructor">John Smith</p>
                  <div class="cart-item-rating">
                    <span class="rating-score">4.8</span>
                    <img src="../../../resources/images/myCart/icon_star.svg" alt="Star" class="rating-star" />
                    <span class="rating-count">(15,420)</span>
                  </div>
                  <p class="cart-item-duration">42 hours</p>
                </div>
                <div class="cart-item-price">
                  <span class="current-price">$59.99</span>
                  <span class="original-price">$129.99</span>
                </div>
              </div>

              <!-- Cart Item 2 -->
              <div class="cart-item">
                <button class="cart-delete-btn">
                  <img src="../../../resources/images/myCart/button_delete.svg" alt="Delete" />
                </button>
                <div class="cart-item-checkbox">
                  <input type="checkbox" id="item2" name="cartItem" class="item-checkbox" />
                  <label for="item2"></label>
                </div>
                <div class="cart-item-thumbnail">
                  <div class="cart-thumbnail-placeholder"></div>
                </div>
                <div class="cart-item-info">
                  <h3 class="cart-item-title">Advanced React & Redux Complete Course</h3>
                  <p class="cart-item-instructor">Sarah Johnson</p>
                  <div class="cart-item-rating">
                    <span class="rating-score">4.9</span>
                    <img src="../../../resources/images/myCart/icon_star.svg" alt="Star" class="rating-star" />
                    <span class="rating-count">(12,350)</span>
                  </div>
                  <p class="cart-item-duration">35 hours</p>
                </div>
                <div class="cart-item-price">
                  <span class="current-price">$79.99</span>
                  <span class="original-price">$149.99</span>
                </div>
              </div>

              <!-- Cart Item 3 -->
              <div class="cart-item">
                <button class="cart-delete-btn">
                  <img src="../../../resources/images/myCart/button_delete.svg" alt="Delete" />
                </button>
                <div class="cart-item-checkbox">
                  <input type="checkbox" id="item3" name="cartItem" class="item-checkbox" />
                  <label for="item3"></label>
                </div>
                <div class="cart-item-thumbnail">
                  <div class="cart-thumbnail-placeholder"></div>
                </div>
                <div class="cart-item-info">
                  <h3 class="cart-item-title">UI/UX Design Masterclass - From Beginner to Pro</h3>
                  <p class="cart-item-instructor">Michael Chen</p>
                  <div class="cart-item-rating">
                    <span class="rating-score">4.7</span>
                    <img src="../../../resources/images/myCart/icon_star.svg" alt="Star" class="rating-star" />
                    <span class="rating-count">(8,920)</span>
                  </div>
                  <p class="cart-item-duration">28 hours</p>
                </div>
                <div class="cart-item-price">
                  <span class="current-price">$49.99</span>
                </div>
              </div>
            </div>

            <!-- Order Summary -->
            <div class="cart-summary">
              <h3 class="summary-title">Tóm tắt đơn hàng</h3>
              
              <div class="summary-row">
                <span class="summary-label">Giá gốc:</span>
                <span class="summary-value" id="originalPrice">$0.00</span>
              </div>
              
              <div class="summary-row">
                <span class="summary-label">Giảm giá:</span>
                <span class="summary-value discount" id="discountPrice">-$0.00</span>
              </div>
              
              <div class="summary-divider"></div>
              
              <div class="summary-row total">
                <span class="summary-label">Tổng cộng:</span>
                <span class="summary-value total-price" id="totalPrice">$0.00</span>
              </div>

              <div class="summary-notice" id="summaryNotice">
                <p>Vui lòng chọn ít nhất 1 khóa học để thanh toán</p>
              </div>
              
              <a href="#" class="btn-checkout" id="checkoutBtn" style="display: none;" onclick="goToCheckout(event)">
                Thanh toán (<span id="selectedCount">0</span>)
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="container footer-inner">
        <div class="footer-links">
          <a href="#">About Us</a>
          <a href="#">Terms</a>
          <a href="#">Privacy Policy</a>
          <a href="#">Support</a>
        </div>
        <div class="Follow-us">Follow us</div>
        <div class="social">
          <img src="../../../resources/images/HomePage/Button-FB.svg" alt="Facebook" />
          <img src="../../../resources/images/HomePage/Button-insta.svg" alt="Instagram" />
          <img src="../../../resources/images/HomePage/Button-yt.svg" alt="YouTube" />
        </div>
        <div class="copy">© 2024 EduLearn. All rights reserved.</div>
      </div>
    </footer>

    <script>
      // Select All functionality
      const selectAllCheckbox = document.getElementById('selectAll');
      
      selectAllCheckbox.addEventListener('change', function() {
        const itemCheckboxes = document.querySelectorAll('.item-checkbox');
        itemCheckboxes.forEach(checkbox => {
          checkbox.checked = this.checked;
        });
        updateSummary();
      });

      // Update select all checkbox state when individual items change
      function updateSelectAllState() {
        const itemCheckboxes = document.querySelectorAll('.item-checkbox');
        const allChecked = Array.from(itemCheckboxes).every(cb => cb.checked);
        const someChecked = Array.from(itemCheckboxes).some(cb => cb.checked);
        
        selectAllCheckbox.checked = allChecked;
        selectAllCheckbox.indeterminate = someChecked && !allChecked;
      }
      
      function updateSummary() {
        let originalTotal = 0;
        let discountTotal = 0;
        let selectedCount = 0;
        
        document.querySelectorAll('.cart-item').forEach((item) => {
          const checkbox = item.querySelector('.cart-item-checkbox input');
          if (checkbox && checkbox.checked) {
            selectedCount++;
            const currentPriceEl = item.querySelector('.current-price');
            const originalPriceEl = item.querySelector('.original-price');
            
            const currentPrice = parseFloat(currentPriceEl.textContent.replace('$', ''));
            const originalPrice = originalPriceEl 
              ? parseFloat(originalPriceEl.textContent.replace('$', '')) 
              : currentPrice;
            
            originalTotal += originalPrice;
            discountTotal += (originalPrice - currentPrice);
          }
        });
        
        const finalTotal = originalTotal - discountTotal;
        
        document.getElementById('originalPrice').textContent = '$' + originalTotal.toFixed(2);
        document.getElementById('discountPrice').textContent = '-$' + discountTotal.toFixed(2);
        document.getElementById('totalPrice').textContent = '$' + finalTotal.toFixed(2);
        
        const notice = document.getElementById('summaryNotice');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const selectedCountEl = document.getElementById('selectedCount');
        
        if (selectedCount > 0) {
          notice.style.display = 'none';
          checkoutBtn.style.display = 'block';
          selectedCountEl.textContent = selectedCount;
        } else {
          notice.style.display = 'block';
          checkoutBtn.style.display = 'none';
        }
        
        updateSelectAllState();
      }
      
      // Add event listeners to individual checkboxes
      document.querySelectorAll('.item-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', updateSummary);
      });

      // Delete item functionality
      document.querySelectorAll('.cart-delete-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const cartItem = this.closest('.cart-item');
          cartItem.style.opacity = '0';
          cartItem.style.transform = 'translateX(-20px)';
          setTimeout(() => {
            cartItem.remove();
            updateCartCount();
            updateSummary();
          }, 300);
        });
      });

      function updateCartCount() {
        const remainingItems = document.querySelectorAll('.cart-item').length;
        document.querySelector('.cart-count').textContent = remainingItems + ' courses in your cart';
      }

      // Save selected items to localStorage and go to checkout
      function goToCheckout(event) {
        event.preventDefault();
        
        const selectedItems = [];
        
        document.querySelectorAll('.cart-item').forEach((item) => {
          const checkbox = item.querySelector('.cart-item-checkbox input');
          if (checkbox && checkbox.checked) {
            const title = item.querySelector('.cart-item-title').textContent;
            const instructor = item.querySelector('.cart-item-instructor').textContent;
            const currentPriceEl = item.querySelector('.current-price');
            const originalPriceEl = item.querySelector('.original-price');
            
            const currentPrice = parseFloat(currentPriceEl.textContent.replace('$', ''));
            const originalPrice = originalPriceEl 
              ? parseFloat(originalPriceEl.textContent.replace('$', '')) 
              : null;
            
            selectedItems.push({
              title: title,
              instructor: instructor,
              currentPrice: currentPrice,
              originalPrice: originalPrice
            });
          }
        });
        
        // Save to localStorage
        localStorage.setItem('checkoutItems', JSON.stringify(selectedItems));
        
        // Navigate to checkout
        window.location.href = 'Payment.html';
      }
    </script>

    <!-- Notification Panel -->
    <div class="noti-overlay" id="notiOverlay"></div>
    <div class="noti-panel" id="notiPanel" role="dialog" aria-labelledby="notiTitle">
      <div class="noti-header">
        <h3 id="notiTitle">Thông báo</h3>
        <button class="noti-close" id="closeNotiBtn" aria-label="Đóng">
          <img src="../../../resources/images/userDashboard/VectorX.svg" alt="" />
        </button>
      </div>
      <ul class="noti-list">
        <li class="noti-item unread">
          <div class="noti-icon noti-icon--course">
            <img src="../../../resources/images/viewNotification/icon_newCourse.svg" alt="New Course" />
          </div>
          <div class="noti-body">
            <p class="noti-title">Khóa học mới đã được thêm</p>
            <p class="noti-desc">Advanced React Patterns đã được thêm vào danh sách của bạn</p>
            <div class="noti-meta">5 phút trước</div>
          </div>
          <span class="noti-dot"></span>
        </li>
        <li class="noti-item unread">
          <div class="noti-icon noti-icon--review">
            <img src="../../../resources/images/viewNotification/icon_reviewNoti.svg" alt="New Review" />
          </div>
          <div class="noti-body">
            <p class="noti-title">Đánh giá mới</p>
            <p class="noti-desc">Sarah Johnson đã đánh giá 5 sao cho khóa học React Fundamentals</p>
            <div class="noti-meta">1 giờ trước</div>
          </div>
          <span class="noti-dot"></span>
        </li>
      </ul>
      <a href="ViewNotification.html" class="noti-viewall">Xem tất cả thông báo</a>
    </div>

    <script>
      // Notification Panel Logic
      const openBtn = document.getElementById("openNotiBtn");
      const closeBtn = document.getElementById("closeNotiBtn");
      const overlay = document.getElementById("notiOverlay");
      const panel = document.getElementById("notiPanel");

      function openPanel() {
        panel.classList.add("show");
        overlay.classList.add("show");
        openBtn.setAttribute("aria-expanded", "true");
      }

      function closePanel() {
        panel.classList.remove("show");
        overlay.classList.remove("show");
        openBtn.setAttribute("aria-expanded", "false");
      }

      if (openBtn) {
        openBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          panel.classList.contains("show") ? closePanel() : openPanel();
        });
      }
      if (closeBtn) closeBtn.addEventListener("click", closePanel);
      if (overlay) overlay.addEventListener("click", closePanel);
      document.addEventListener("keydown", (e) => e.key === "Escape" && closePanel());

      if (panel) {
        panel.addEventListener("click", (e) => {
          const item = e.target.closest(".noti-item.unread");
          if (!item) return;
          item.classList.remove("unread");
          item.querySelector(".noti-dot")?.remove();
        });
      }

      // User Menu Dropdown Logic
      const userMenuBtn = document.getElementById("userMenuBtn");
      const userMenuDropdown = document.getElementById("userMenuDropdown");

      if (userMenuBtn && userMenuDropdown) {
        userMenuBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          const isOpen = userMenuDropdown.classList.contains("show");
          userMenuDropdown.classList.toggle("show");
          userMenuBtn.setAttribute("aria-expanded", !isOpen);
        });

        document.addEventListener("click", (e) => {
          if (!userMenuDropdown.contains(e.target) && !userMenuBtn.contains(e.target)) {
            userMenuDropdown.classList.remove("show");
            userMenuBtn.setAttribute("aria-expanded", "false");
          }
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && userMenuDropdown.classList.contains("show")) {
            userMenuDropdown.classList.remove("show");
            userMenuBtn.setAttribute("aria-expanded", "false");
          }
        });
      }
    </script>
  </body>
</html>